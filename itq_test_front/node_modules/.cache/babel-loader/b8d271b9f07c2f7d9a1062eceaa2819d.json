{"ast":null,"code":"import _defineProperty from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import Form from'react-bootstrap/Form';import Button from'react-bootstrap/Button';import axios from'axios';import cs from'./Draw_graphs.module.css';import fconfig from\"../fconfig.json\";import Col from'react-bootstrap/Col';import Row from'react-bootstrap/Row';import ReactEcharts from'echarts-for-react';var base_url=JSON.stringify(fconfig[\"api\"][\"root\"]).replace(/['\"]+/g,'');var DrawGraphs=/*#__PURE__*/function(_React$Component){_inherits(DrawGraphs,_React$Component);function DrawGraphs(props){var _this;_classCallCheck(this,DrawGraphs);_this=_possibleConstructorReturn(this,_getPrototypeOf(DrawGraphs).call(this,props));_this.state={isFetching:true,error:null,data:null,start_date:\"2020-01-13\",end_date:\"2020-01-14\",city_name:\"Moscow\",style:{height_graph:\"400px\"}};_this.onChange=_this.onChange.bind(_assertThisInitialized(_this));_this.handleClick=_this.handleClick.bind(_assertThisInitialized(_this));_this.UpdateState=_this.UpdateState.bind(_assertThisInitialized(_this));_this.PutState=_this.PutState.bind(_assertThisInitialized(_this));_this.getOption=_this.getOption.bind(_assertThisInitialized(_this));return _this;}///////////////////////\n_createClass(DrawGraphs,[{key:\"checkData\",value:function checkData(response){//если какие то ошибки (надо их выводить на экран)\nif('error'in response.data){var Err=new Error(response.data['error']);this.setState({error:Err});throw Err;}//если пустой датасет\nif(response.data!=null)if(response.data['data'].length===0){var _Err=new Error(\"нет данных\");this.setState({error:_Err});throw _Err;}}///////////////////////\n},{key:\"PutState\",value:function PutState(event){var _this2=this;axios.get(base_url+'/RR/api/v1.0/data/upload',{params:{city:this.state.city_name,start_date:this.state.start_date,end_date:this.state.end_date},headers:{// Перечисляем разрешённые методы\n\"Access-Control-Allow-Methods\":\"GET\"}}).then(function(response){_this2.checkData(response);console.log(response);// выводим в консоль получаемые обьекты\n_this2.setState({data:response.data});}).catch(function(e){console.log(e);_this2.setState({error:e});alert(_this2.state.error.message);});}///////////////////////\n},{key:\"UpdateState\",value:function UpdateState(event){var _this3=this;axios.get(base_url+'/RR/api/v1.0/data/get',{params:{city:this.state.city_name,start_date:this.state.start_date,end_date:this.state.end_date},headers:{// Перечисляем разрешённые методы\n\"Access-Control-Allow-Methods\":\"GET\"}}).then(function(response){_this3.checkData(response);console.log(response);// выводим в консоль получаемые обьекты\n_this3.setState({data:response.data});}).catch(function(e){console.log(e);_this3.setState({error:e});alert(_this3.state.error.message);});}/////////////////////////////////////\n},{key:\"handleClick\",value:function handleClick(event){var name=event.target.name;event.preventDefault();if(name===\"get\")this.UpdateState(event);if(name===\"upload\")this.PutState(event);}//////////////////////////////////////\n},{key:\"onChange\",value:function onChange(e){var name=e.target.name;var value=e.target.value;this.setState(_defineProperty({},name,value));}//////////////////////\n},{key:\"componentDidMount\",value:function componentDidMount(event){this.UpdateState(event);}/////////////////////\n//функция рисования графика\n},{key:\"getOption\",value:function getOption(type_data){var title=\"\",type_unit=\"\";if(type_data===\"temp\"){title=\"Температура\";type_unit=\"[C]\";}if(type_data===\"pres\"){title=\"Давление\";type_unit=\"[mb]\";}if(type_data===\"rh\"){title=\"влажность\";type_unit=\"[%]\";}//ждем пока данные полностью загрузятся и тогда отрисовываем график\nif(this.state.data!==null){var option={legend:{},title:{text:type_unit},tooltip:{},dataset:{dimensions:['date',type_data],source:this.state.data['data'].map(function(item){return _defineProperty({date:new Date(item.dt)},type_data,item[type_data]);})},xAxis:{type:'time'},yAxis:{},series:[{name:title,type:'line',smooth:0.5//включаем сглаживание\n}]};return option;}else{var _option={};return _option;}}////////////////////\n},{key:\"renderTitle\",value:function renderTitle(data){if(this.state.data!==null){return React.createElement(\"p\",null,React.createElement(\"b\",null,\"\\u0412\\u044B\\u0431\\u0440\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0433\\u043E\\u0440\\u043E\\u0434 - \",this.state.data['data'][0]['city_name'],\" (\",this.state.data['data'][0]['country_code'],\")\"));}else{return React.createElement(\"p\",null);}}},{key:\"render\",value:function render(){var _this$state=this.state,style=_this$state.style,data=_this$state.data;return React.createElement(\"div\",null,React.createElement(\"div\",{className:cs.page__wrapper},React.createElement(\"div\",{className:\"\".concat(cs.page__title_wrapper,\" \").concat(cs.page__main_title_wrapper)},React.createElement(\"b\",null,\"\\u041F\\u043E\\u0433\\u043E\\u0434\\u043D\\u044B\\u0435 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435\"),React.createElement(\"hr\",null)),React.createElement(\"div\",{className:cs.page__form_data_wrapper},React.createElement(\"p\",{className:cs.page__title_form_data_wrapper},React.createElement(\"b\",null,\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043E\\u0441\\u043D\\u043E\\u0432\\u043D\\u044B\\u0435 \\u043F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u044B:\")),React.createElement(Form,null,React.createElement(Form.Row,null,React.createElement(Form.Group,{as:Col,controlId:\"formHorizontal1\"},React.createElement(\"div\",{className:cs.row_three_item},React.createElement(Form.Label,{bsPrefix:cs.title_field},React.createElement(\"b\",null,\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u044C\\u043D\\u0430\\u044F \\u0434\\u0430\\u0442\\u0430:\")),React.createElement(Form.Control,{name:\"start_date\",defaultValue:\"2020-01-13\",type:\"date\",required:\"required\",onChange:this.onChange}))),React.createElement(Form.Group,{as:Col,controlId:\"formHorizontal2\"},React.createElement(\"div\",{className:cs.row_three_item},React.createElement(Form.Label,{bsPrefix:cs.title_field},React.createElement(\"b\",null,\"\\u041A\\u043E\\u043D\\u0435\\u0447\\u043D\\u0430\\u044F \\u0434\\u0430\\u0442\\u0430:\")),React.createElement(Form.Control,{name:\"end_date\",defaultValue:\"2020-01-14\",type:\"date\",required:\"required\",onChange:this.onChange}))),React.createElement(Form.Group,{as:Col,controlId:\"formHorizontal2\"},React.createElement(\"div\",{className:cs.row_three_item},React.createElement(Form.Label,{bsPrefix:cs.title_field},React.createElement(\"b\",null,\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0433\\u043E\\u0440\\u043E\\u0434\\u0430 (\\u043D\\u0430 \\u0430\\u043D\\u0433\\u043B\\u0438\\u0439\\u0441\\u043A\\u043E\\u043C):\")),React.createElement(Form.Control,{name:\"city_name\",defaultValue:\"Moscow\",type:\"text\",required:\"required\",onChange:this.onChange})))),React.createElement(\"p\",null,React.createElement(\"i\",null,\"\\u0412\\u043D\\u0435\\u0448\\u043D\\u0438\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441 https://www.weatherbit.io/ \\u043E\\u0433\\u0440\\u0430\\u043D\\u0438\\u0447\\u0438\\u0432\\u0430\\u0435\\u0442 \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0437\\u0430\\u043F\\u0440\\u0430\\u0448\\u0438\\u0432\\u0435\\u043C\\u044B\\u0445 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u0441 \\u0440\\u0430\\u0437\\u043D\\u044B\\u043C \\u0438\\u043D\\u0442\\u0435\\u0440\\u0432\\u0430\\u043B\\u043E\\u043C \\u0432\\u0440\\u0435\\u043C\\u0435\\u043D\\u0438 \\u0434\\u043E \\u043E\\u0434\\u043D\\u043E\\u0433\\u043E \\u0440\\u0430\\u0437\\u0430 \\u0432 \\u0441\\u0443\\u0442\\u043A\\u0438.\"),React.createElement(\"br\",null),React.createElement(\"i\",null,\"\\u0421\\u043E\\u043E\\u0442\\u0432\\u0435\\u0441\\u0442\\u0432\\u0435\\u043D\\u043D\\u043E \\u0432 \\u0441\\u0443\\u0442\\u043A\\u0438 \\u043C\\u043E\\u0436\\u043D\\u043E \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0441 \\u0432\\u043D\\u0435\\u0448\\u043D\\u0435\\u0433\\u043E \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0430 \\u0442\\u043E\\u043B\\u044C\\u043A\\u043E \\u043E\\u0434\\u0438\\u043D \\u0438\\u043D\\u0442\\u0435\\u0440\\u0432\\u0430\\u043B \\u0432\\u0440\\u0435\\u043C\\u0435\\u043D\\u0438 \\u0434\\u043B\\u044F \\u043B\\u044E\\u0431\\u043E\\u0433\\u043E \\u0433\\u043E\\u0440\\u043E\\u0434\\u0430.\"),React.createElement(\"br\",null),React.createElement(\"i\",null,\"\\u041C\\u0430\\u043A\\u0441\\u0438\\u043C\\u0430\\u043B\\u044C\\u043D\\u043E\\u0435 \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u043E\\u0432 \\u043A \\u0432\\u043D\\u0435\\u0448\\u043D\\u0435\\u043C\\u0443 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0443 \\u043E\\u0433\\u0440\\u0430\\u043D\\u0438\\u0447\\u0438\\u0432\\u0430\\u0435\\u0442\\u0441\\u044F \\u0434\\u043E 500 \\u0432 \\u0441\\u0443\\u0442\\u043A\\u0438.\")),React.createElement(Row,null,React.createElement(Col,{xs:4},React.createElement(Button,{type:\"submit\",variant:\"warning\",name:\"upload\",className:cs.button_upload,onClick:this.handleClick},\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0441 \\u0432\\u043D\\u0435\\u0448\\u043D\\u0435\\u0433\\u043E \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441\\u0430\")),React.createElement(Col,{xs:4},React.createElement(Button,{type:\"submit\",variant:\"danger\",name:\"get\",className:cs.button_upload,onClick:this.handleClick},\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0438\\u0437 \\u043B\\u043E\\u043A\\u0430\\u043B\\u044C\\u043D\\u043E\\u0439 \\u0431\\u0430\\u0437\\u044B\")))),React.createElement(\"hr\",null)),React.createElement(\"div\",{className:cs.page__title_wrapper},this.renderTitle(data)),React.createElement(\"div\",{className:cs.page__graph_data_wrapper},React.createElement(Row,null,React.createElement(Col,null,React.createElement(ReactEcharts,{ref:\"echartsInstance\",style:{height:style.height_graph},option:this.getOption('temp')})),React.createElement(Col,null,React.createElement(ReactEcharts,{ref:\"echartsInstance\",style:{height:style.height_graph},option:this.getOption('pres')})),React.createElement(Col,null,React.createElement(ReactEcharts,{ref:\"echartsInstance\",style:{height:style.height_graph},option:this.getOption('rh')}))))));}}]);return DrawGraphs;}(React.Component);export default DrawGraphs;","map":{"version":3,"sources":["/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/src/components/Draw_graphs.jsx"],"names":["React","Form","Button","axios","cs","fconfig","Col","Row","ReactEcharts","base_url","JSON","stringify","replace","DrawGraphs","props","state","isFetching","error","data","start_date","end_date","city_name","style","height_graph","onChange","bind","handleClick","UpdateState","PutState","getOption","response","Err","Error","setState","length","event","get","params","city","headers","then","checkData","console","log","catch","e","alert","message","name","target","preventDefault","value","type_data","title","type_unit","option","legend","text","tooltip","dataset","dimensions","source","map","item","date","Date","dt","xAxis","type","yAxis","series","smooth","page__wrapper","page__title_wrapper","page__main_title_wrapper","page__form_data_wrapper","page__title_form_data_wrapper","row_three_item","title_field","button_upload","renderTitle","page__graph_data_wrapper","height","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport axios from 'axios';\nimport cs from './Draw_graphs.module.css';\nimport fconfig from \"../fconfig.json\";\nimport Col from 'react-bootstrap/Col';\nimport Row from 'react-bootstrap/Row';\nimport ReactEcharts from 'echarts-for-react';\n\nvar base_url = JSON.stringify(fconfig[\"api\"][\"root\"]).replace(/['\"]+/g, '')\n\n\nclass DrawGraphs extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isFetching: true,\n      error: null,\n      data : null,\n      start_date : \"2020-01-13\",\n      end_date : \"2020-01-14\",\n      city_name : \"Moscow\",\n      style : {\n        height_graph : \"400px\"\n      }\n    }\n\n    this.onChange = this.onChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.UpdateState = this.UpdateState.bind(this);\n    this.PutState = this.PutState.bind(this);\n    this.getOption = this.getOption.bind(this);\n  }\n  ///////////////////////\n  checkData(response) {\n\n    //если какие то ошибки (надо их выводить на экран)\n    if ('error' in response.data)\n    {\n      let Err = new Error(response.data['error']);\n      this.setState({\n        error : Err\n      })\n      throw Err;\n    }\n\n    //если пустой датасет\n    if (response.data != null)\n    if (response.data['data'].length === 0)\n    {\n      let Err = new Error(\"нет данных\");\n      this.setState({\n        error: Err\n      })\n      throw Err;\n    }\n  }\n  ///////////////////////\n  PutState(event) {\n\n    axios.get(base_url+'/RR/api/v1.0/data/upload',{\n      params: {\n        city : this.state.city_name,\n        start_date : this.state.start_date,\n        end_date : this.state.end_date\n      },\n      headers: {\n        // Перечисляем разрешённые методы\n        \"Access-Control-Allow-Methods\": \"GET\"\n      }\n    })\n    .then(\n      (response) => {\n        this.checkData(response);\n        console.log(response) // выводим в консоль получаемые обьекты\n        this.setState({\n          data: response.data\n        });\n      }\n    )\n    .catch(e => {\n      console.log(e)\n      this.setState({\n        error: e\n      });\n      alert(this.state.error.message)\n    }\n  )\n\n}\n\n///////////////////////\nUpdateState(event) {\n\n  axios.get(base_url+'/RR/api/v1.0/data/get',{\n    params: {\n      city : this.state.city_name,\n      start_date : this.state.start_date,\n      end_date : this.state.end_date\n    },\n    headers: {\n      // Перечисляем разрешённые методы\n      \"Access-Control-Allow-Methods\": \"GET\"\n    }\n  })\n  .then(\n    (response) => {\n      this.checkData(response);\n      console.log(response) // выводим в консоль получаемые обьекты\n      this.setState({\n        data: response.data\n      });\n    }\n  )\n  .catch(e => {\n    console.log(e)\n    this.setState({\n      error: e\n    });\n    alert(this.state.error.message)\n  }\n)\n\n}\n/////////////////////////////////////\n\nhandleClick(event) {\n  const name = event.target.name;\n\n\n  event.preventDefault();\n\n  if (name === \"get\")\n  this.UpdateState(event)\n\n  if (name === \"upload\")\n  this.PutState(event)\n\n}\n//////////////////////////////////////\nonChange(e) {\n  const name = e.target.name;\n  const value = e.target.value;\n\n  this.setState({\n    [name]: value\n  })\n\n}\n\n//////////////////////\ncomponentDidMount(event) {\n\n  this.UpdateState(event)\n\n}\n/////////////////////\n//функция рисования графика\ngetOption(type_data) {\n\n  let title = \"\",type_unit = \"\";\n  if (type_data === \"temp\")\n  {\n    title = \"Температура\"\n    type_unit =\"[C]\"\n  }\n\n\n  if (type_data === \"pres\")\n  {\n    title = \"Давление\"\n    type_unit =\"[mb]\"\n  }\n\n\n\n  if (type_data === \"rh\")\n  {\n    title = \"влажность\"\n    type_unit =\"[%]\"\n  }\n\n\n  //ждем пока данные полностью загрузятся и тогда отрисовываем график\n  if (this.state.data !== null)\n  {\n\n    let option = {\n      legend: {},\n      title: {text:type_unit},\n      tooltip: {},\n      dataset: {\n        dimensions: ['date',type_data],\n        source: this.state.data['data'].map(\n          (item) => (\n            {\n              date: new Date(item.dt),\n              [type_data]: item[type_data]\n            }\n          )\n        )\n      },\n      xAxis: {type: 'time'},\n      yAxis: {},\n      series: [\n        {\n          name: title,\n          type: 'line',\n          smooth: 0.5  //включаем сглаживание\n        },\n      ]\n    };\n    return option;\n  }\n  else\n  {\n    let option = {};\n    return option;\n  }\n\n}\n////////////////////\nrenderTitle(data) {\n  if (this.state.data !== null)\n  {\n    return( <p><b>Выбранный город - {this.state.data['data'][0]['city_name']} ({this.state.data['data'][0]['country_code']})</b></p> );\n  }\n  else {\n    return(<p></p>);\n  }\n\n}\n\n\nrender() {\n  let {style,data} = this.state;\n    return (\n      <div>\n        <div className={cs.page__wrapper}>\n          <div className={`${cs.page__title_wrapper} ${cs.page__main_title_wrapper}`}>\n            <b>Погодные данные</b>\n            <hr></hr>\n          </div>\n          <div className={cs.page__form_data_wrapper}>\n            <p className={cs.page__title_form_data_wrapper}><b>Введите основные параметры:</b></p>\n            <Form>\n              <Form.Row>\n                <Form.Group  as={Col} controlId=\"formHorizontal1\">\n                  <div className={cs.row_three_item}>\n                    <Form.Label bsPrefix={cs.title_field}><b>Начальная дата:</b></Form.Label>\n                    <Form.Control name=\"start_date\" defaultValue=\"2020-01-13\" type=\"date\" required=\"required\"  onChange={this.onChange} />\n                  </div>\n                </Form.Group>\n\n                <Form.Group as={Col} controlId=\"formHorizontal2\">\n                  <div className={cs.row_three_item}>\n                    <Form.Label bsPrefix={cs.title_field}><b>Конечная дата:</b></Form.Label>\n                    <Form.Control name=\"end_date\" defaultValue=\"2020-01-14\" type=\"date\" required=\"required\" onChange={this.onChange} />\n                  </div>\n                </Form.Group>\n\n                <Form.Group as={Col} controlId=\"formHorizontal2\">\n                  <div className={cs.row_three_item}>\n                    <Form.Label bsPrefix={cs.title_field}><b>Название города (на английском):</b></Form.Label>\n                    <Form.Control name=\"city_name\" defaultValue=\"Moscow\" type=\"text\" required=\"required\" onChange={this.onChange} />\n                  </div>\n                </Form.Group>\n              </Form.Row>\n              <p><i>Внешний ресурс https://www.weatherbit.io/ ограничивает количество запрашивемых данных с разным интервалом времени до одного раза в сутки.</i>\n              <br></br><i>Соотвественно в сутки можно загрузить с внешнего ресурса только один интервал времени для любого города.</i>\n              <br></br><i>Максимальное количество запросов к внешнему ресурсу ограничивается до 500 в сутки.</i></p>\n              <Row>\n                <Col xs={4}>\n                    <Button type=\"submit\" variant=\"warning\" name=\"upload\" className={cs.button_upload}  onClick={this.handleClick}>\n                      Загрузить данные с внешнего ресурса\n                    </Button>\n                </Col>\n                <Col xs={4}>\n                    <Button type=\"submit\" variant=\"danger\" name=\"get\" className={cs.button_upload}  onClick={this.handleClick}>\n                      Загрузить данные из локальной базы\n                    </Button>\n                </Col>\n              </Row>\n            </Form>\n            <hr></hr>\n          </div>\n\n          <div className={cs.page__title_wrapper}>\n            {this.renderTitle(data)}\n          </div>\n          <div className={cs.page__graph_data_wrapper}>\n            <Row>\n              <Col>\n                <ReactEcharts ref='echartsInstance'\n                  style={{ height: style.height_graph}}\n                  option={this.getOption('temp')} />\n              </Col>\n              <Col>\n                <ReactEcharts ref='echartsInstance'\n                  style={{ height: style.height_graph}}\n                  option={this.getOption('pres')} />\n              </Col>\n              <Col>\n                <ReactEcharts ref='echartsInstance'\n                  style={{ height: style.height_graph}}\n                  option={this.getOption('rh')} />\n              </Col>\n            </Row>\n          </div>\n        </div>\n      </div>\n    )\n}\n\n}\n\n\nexport default DrawGraphs;\n"]},"metadata":{},"sourceType":"module"}