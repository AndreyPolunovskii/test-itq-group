{"ast":null,"code":"var _jsxFileName = \"/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/src/components/Draw_graphs.jsx\";\nimport React from 'react';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport axios from 'axios';\nimport cs from './Draw_graphs.module.css';\nimport fconfig from \"../fconfig.json\";\nimport Col from 'react-bootstrap/Col';\nimport Row from 'react-bootstrap/Row';\nimport ReactEcharts from 'echarts-for-react';\nvar base_url = JSON.stringify(fconfig[\"api\"][\"root\"]).replace(/['\"]+/g, '');\n\nclass DrawGraphs extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isFetching: true,\n      error: null,\n      data: null,\n      start_date: \"2020-01-10\",\n      end_date: \"2020-01-14\",\n      city_name: \"Moscow\",\n      style: {\n        height_graph: \"400px\"\n      }\n    };\n    this.onChange = this.onChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.UpdateState = this.UpdateState.bind(this);\n    this.PutState = this.PutState.bind(this);\n    this.getOption = this.getOption.bind(this);\n  } ///////////////////////\n\n\n  checkData(response) {\n    //если какие то ошибки (надо их выводить на экран)\n    if ('error' in response.data) {\n      let Err = new Error(response.data['error']);\n      this.setState({\n        error: Err\n      });\n      throw Err;\n    } //если пустой датасет\n\n\n    if (response.data != null) if (response.data['data'].length == 0) {\n      let Err = new Error(\"нет данных\");\n      this.setState({\n        error: Err\n      });\n      throw Err;\n    }\n  } ///////////////////////\n\n\n  PutState(event) {\n    axios.get(base_url + '/RR/api/v1.0/data/upload', {\n      params: {\n        city: this.state.city_name,\n        start_date: this.state.start_date,\n        end_date: this.state.end_date\n      },\n      headers: {\n        // Перечисляем разрешённые методы\n        \"Access-Control-Allow-Methods\": \"GET\"\n      }\n    }).then(response => {\n      this.checkData(response);\n      console.log(response); // выводим в консоль получаемые обьекты\n\n      this.setState({\n        data: response.data\n      });\n    }).catch(e => {\n      console.log(e);\n      this.setState({\n        error: e\n      });\n    });\n  } ///////////////////////\n\n\n  UpdateState(event) {\n    axios.get(base_url + '/RR/api/v1.0/data/get', {\n      params: {\n        city: this.state.city_name,\n        start_date: this.state.start_date,\n        end_date: this.state.end_date\n      },\n      headers: {\n        // Перечисляем разрешённые методы\n        \"Access-Control-Allow-Methods\": \"GET\"\n      }\n    }).then(response => {\n      this.checkData(response);\n      console.log(response); // выводим в консоль получаемые обьекты\n\n      this.setState({\n        data: response.data\n      });\n    }).catch(e => {\n      console.log(e);\n      this.setState({\n        error: e\n      });\n    });\n  } /////////////////////////////////////\n\n\n  handleClick(event) {\n    const name = event.target.name;\n    event.preventDefault();\n    if (name === \"get\") this.UpdateState(event);\n    if (name === \"upload\") this.PutState(event);\n  } //////////////////////////////////////\n\n\n  onChange(e) {\n    const name = e.target.name;\n    const value = e.target.value;\n    this.setState({\n      [name]: value\n    });\n  } //////////////////////\n\n\n  componentDidMount(event) {\n    this.UpdateState(event);\n  } /////////////////////\n  //функция рисования графика\n\n\n  getOption(type_data) {\n    let title = \"\";\n    if (type_data === \"temp\") title = \"Температура\";\n    if (type_data === \"pres\") title = \"Давление\";\n    if (type_data === \"rh\") title = \"влажность\"; //ждем пока данные полностью загрузятся и тогда отрисовываем график\n\n    if (this.state.data !== null) {\n      let option = {\n        legend: {},\n        tooltip: {},\n        dataset: {\n          dimensions: ['date', type_data],\n          source: this.state.data['data'].map(item => ({\n            date: new Date(item.dt),\n            [type_data]: item[type_data]\n          }))\n        },\n        xAxis: {\n          type: 'time'\n        },\n        yAxis: {},\n        series: [{\n          name: title,\n          type: 'line'\n        }]\n      };\n      return option;\n    } else {\n      let option = {};\n      return option;\n    }\n  } ////////////////////\n\n\n  renderTitle(data) {\n    if (this.state.data !== null) {\n      return React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, \"\\u0412\\u044B\\u0431\\u0440\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0433\\u043E\\u0440\\u043E\\u0434 - \", this.state.data['data'][0]['city_name'], \" (\", this.state.data['data'][0]['country_code'], \")\"));\n    } else {\n      return React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      });\n    }\n  }\n\n  render() {\n    let _this$state = this.state,\n        style = _this$state.style,\n        data = _this$state.data,\n        error = _this$state.error;\n\n    if (error) {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, error.message));\n    } else {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.page__wrapper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.page__form_data_wrapper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(Form, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, React.createElement(Form.Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      }, React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"formHorizontal1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.row_three_item,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        bsPrefix: cs.title_field,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, \"\\u041D\\u0430\\u0447\\u0430\\u043B\\u044C\\u043D\\u0430\\u044F \\u0434\\u0430\\u0442\\u0430:\")), React.createElement(Form.Control, {\n        name: \"start_date\",\n        defaultValue: \"2020-01-10\",\n        type: \"date\",\n        required: \"required\",\n        onChange: this.onChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }))), React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"formHorizontal2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.row_three_item,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        bsPrefix: cs.title_field,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, \"\\u041A\\u043E\\u043D\\u0435\\u0447\\u043D\\u0430\\u044F \\u0434\\u0430\\u0442\\u0430:\")), React.createElement(Form.Control, {\n        name: \"end_date\",\n        defaultValue: \"2020-01-14\",\n        type: \"date\",\n        required: \"required\",\n        onChange: this.onChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      }))), React.createElement(Form.Group, {\n        as: Col,\n        controlId: \"formHorizontal2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.row_three_item,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, React.createElement(Form.Label, {\n        bsPrefix: cs.title_field,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, \"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0433\\u043E\\u0440\\u043E\\u0434\\u0430:\")), React.createElement(Form.Control, {\n        name: \"city_name\",\n        defaultValue: \"Moscow\",\n        type: \"text\",\n        required: \"required\",\n        onChange: this.onChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      })))), React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }, React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.aligin_bottom,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"submit\",\n        name: \"upload\",\n        className: cs.button_upload,\n        onClick: this.handleClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      }, \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435\"))), React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: cs.aligin_bottom,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"submit\",\n        name: \"get\",\n        className: cs.button_upload,\n        onClick: this.handleClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268\n        },\n        __self: this\n      }, \"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435\")))))), React.createElement(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: cs.page__title_wrapper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      }, this.renderTitle(data)), React.createElement(\"div\", {\n        className: cs.page__graph_data_wrapper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280\n        },\n        __self: this\n      }, React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }, React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282\n        },\n        __self: this\n      }, React.createElement(ReactEcharts, {\n        ref: \"echartsInstance\",\n        style: {\n          height: style.height_graph\n        },\n        option: this.getOption('temp'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283\n        },\n        __self: this\n      })), React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287\n        },\n        __self: this\n      }, React.createElement(ReactEcharts, {\n        ref: \"echartsInstance\",\n        style: {\n          height: style.height_graph\n        },\n        option: this.getOption('pres'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288\n        },\n        __self: this\n      })), React.createElement(Col, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }, React.createElement(ReactEcharts, {\n        ref: \"echartsInstance\",\n        style: {\n          height: style.height_graph\n        },\n        option: this.getOption('rh'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293\n        },\n        __self: this\n      }))))));\n    }\n  }\n\n}\n\nexport default DrawGraphs;","map":{"version":3,"sources":["/home/andrey/my_projects/test_tasks/test_itq-group/itq_test_front_api/src/components/Draw_graphs.jsx"],"names":["React","Form","Button","axios","cs","fconfig","Col","Row","ReactEcharts","base_url","JSON","stringify","replace","DrawGraphs","Component","constructor","props","state","isFetching","error","data","start_date","end_date","city_name","style","height_graph","onChange","bind","handleClick","UpdateState","PutState","getOption","checkData","response","Err","Error","setState","length","event","get","params","city","headers","then","console","log","catch","e","name","target","preventDefault","value","componentDidMount","type_data","title","option","legend","tooltip","dataset","dimensions","source","map","item","date","Date","dt","xAxis","type","yAxis","series","renderTitle","render","message","page__wrapper","page__form_data_wrapper","row_three_item","title_field","aligin_bottom","button_upload","page__title_wrapper","page__graph_data_wrapper","height"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Form from 'react-bootstrap/Form';\nimport Button from 'react-bootstrap/Button';\nimport axios from 'axios';\nimport cs from './Draw_graphs.module.css';\nimport fconfig from \"../fconfig.json\";\nimport Col from 'react-bootstrap/Col';\nimport Row from 'react-bootstrap/Row';\nimport ReactEcharts from 'echarts-for-react';\n\nvar base_url = JSON.stringify(fconfig[\"api\"][\"root\"]).replace(/['\"]+/g, '')\n\n\nclass DrawGraphs extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isFetching: true,\n      error: null,\n      data : null,\n      start_date : \"2020-01-10\",\n      end_date : \"2020-01-14\",\n      city_name : \"Moscow\",\n      style : {\n        height_graph : \"400px\"\n      }\n    }\n\n    this.onChange = this.onChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.UpdateState = this.UpdateState.bind(this);\n    this.PutState = this.PutState.bind(this);\n    this.getOption = this.getOption.bind(this);\n  }\n  ///////////////////////\n  checkData(response) {\n\n    //если какие то ошибки (надо их выводить на экран)\n    if ('error' in response.data)\n    {\n      let Err = new Error(response.data['error']);\n      this.setState({\n        error : Err\n      })\n      throw Err;\n    }\n\n    //если пустой датасет\n    if (response.data != null)\n    if (response.data['data'].length == 0)\n    {\n      let Err = new Error(\"нет данных\");\n      this.setState({\n        error: Err\n      })\n      throw Err;\n    }\n  }\n  ///////////////////////\n  PutState(event) {\n\n    axios.get(base_url+'/RR/api/v1.0/data/upload',{\n      params: {\n        city : this.state.city_name,\n        start_date : this.state.start_date,\n        end_date : this.state.end_date\n      },\n      headers: {\n        // Перечисляем разрешённые методы\n        \"Access-Control-Allow-Methods\": \"GET\"\n      }\n    })\n    .then(\n      (response) => {\n        this.checkData(response);\n        console.log(response) // выводим в консоль получаемые обьекты\n        this.setState({\n          data: response.data\n        });\n      }\n    )\n    .catch(e => {\n      console.log(e)\n      this.setState({\n        error: e\n      });\n    }\n  )\n\n}\n\n///////////////////////\nUpdateState(event) {\n\n  axios.get(base_url+'/RR/api/v1.0/data/get',{\n    params: {\n      city : this.state.city_name,\n      start_date : this.state.start_date,\n      end_date : this.state.end_date\n    },\n    headers: {\n      // Перечисляем разрешённые методы\n      \"Access-Control-Allow-Methods\": \"GET\"\n    }\n  })\n  .then(\n    (response) => {\n      this.checkData(response);\n      console.log(response) // выводим в консоль получаемые обьекты\n      this.setState({\n        data: response.data\n      });\n    }\n  )\n  .catch(e => {\n    console.log(e)\n    this.setState({\n      error: e\n    });\n  }\n)\n\n}\n/////////////////////////////////////\n\nhandleClick(event) {\n  const name = event.target.name;\n\n\n  event.preventDefault();\n\n  if (name === \"get\")\n  this.UpdateState(event)\n\n  if (name === \"upload\")\n  this.PutState(event)\n\n}\n//////////////////////////////////////\nonChange(e) {\n  const name = e.target.name;\n  const value = e.target.value;\n\n  this.setState({\n    [name]: value\n  })\n\n}\n\n//////////////////////\ncomponentDidMount(event) {\n\n  this.UpdateState(event)\n\n}\n/////////////////////\n//функция рисования графика\ngetOption(type_data) {\n\n  let title = \"\";\n  if (type_data === \"temp\")\n  title = \"Температура\"\n\n  if (type_data === \"pres\")\n  title = \"Давление\"\n\n  if (type_data === \"rh\")\n  title = \"влажность\"\n\n  //ждем пока данные полностью загрузятся и тогда отрисовываем график\n  if (this.state.data !== null)\n  {\n\n    let option = {\n      legend: {},\n      tooltip: {},\n      dataset: {\n        dimensions: ['date',type_data],\n        source: this.state.data['data'].map(\n          (item) => (\n            {\n              date: new Date(item.dt),\n              [type_data]: item[type_data]\n            }\n          )\n        )\n      },\n      xAxis: {type: 'time'},\n      yAxis: {},\n      series: [\n        {\n          name: title,\n          type: 'line'\n        },\n      ]\n    };\n    return option;\n  }\n  else\n  {\n    let option = {};\n    return option;\n  }\n\n}\n////////////////////\nrenderTitle(data) {\n  if (this.state.data !== null)\n  {\n    return( <p><b>Выбранный город - {this.state.data['data'][0]['city_name']} ({this.state.data['data'][0]['country_code']})</b></p> );\n  }\n  else {\n    return(<p></p>);\n  }\n\n}\n\n\nrender() {\n  let {style,data,error} = this.state\n  if (error)\n  {\n    return (\n      <div>\n        <p>{error.message}</p>\n      </div>\n    );\n  }\n  else {\n    return (\n      <div>\n        <div className={cs.page__wrapper}>\n          <div className={cs.page__form_data_wrapper}>\n            <Form>\n              <Form.Row>\n                <Form.Group  as={Col} controlId=\"formHorizontal1\">\n                  <div className={cs.row_three_item}>\n                    <Form.Label bsPrefix={cs.title_field}><b>Начальная дата:</b></Form.Label>\n                    <Form.Control name=\"start_date\" defaultValue=\"2020-01-10\" type=\"date\" required=\"required\"  onChange={this.onChange} />\n                  </div>\n                </Form.Group>\n\n                <Form.Group as={Col} controlId=\"formHorizontal2\">\n                  <div className={cs.row_three_item}>\n                    <Form.Label bsPrefix={cs.title_field}><b>Конечная дата:</b></Form.Label>\n                    <Form.Control name=\"end_date\" defaultValue=\"2020-01-14\" type=\"date\" required=\"required\" onChange={this.onChange} />\n                  </div>\n                </Form.Group>\n\n                <Form.Group as={Col} controlId=\"formHorizontal2\">\n                  <div className={cs.row_three_item}>\n                    <Form.Label bsPrefix={cs.title_field}><b>Название города:</b></Form.Label>\n                    <Form.Control name=\"city_name\" defaultValue=\"Moscow\" type=\"text\" required=\"required\" onChange={this.onChange} />\n                  </div>\n                </Form.Group>\n              </Form.Row>\n\n              <Row>\n                <Col>\n                  <div className={cs.aligin_bottom} >\n                    <Button type=\"submit\" name=\"upload\" className={cs.button_upload}  onClick={this.handleClick}>\n                      Загрузить данные\n                    </Button>\n                  </div>\n                </Col>\n                <Col>\n                  <div className={cs.aligin_bottom} >\n                    <Button type=\"submit\" name=\"get\" className={cs.button_upload}  onClick={this.handleClick}>\n                      Обновить данные\n                    </Button>\n                  </div>\n                </Col>\n              </Row>\n            </Form>\n          </div>\n          <hr></hr>\n          <div className={cs.page__title_wrapper}>\n            {this.renderTitle(data)}\n          </div>\n          <div className={cs.page__graph_data_wrapper}>\n            <Row>\n              <Col>\n                <ReactEcharts ref='echartsInstance'\n                  style={{ height: style.height_graph}}\n                  option={this.getOption('temp')} />\n              </Col>\n              <Col>\n                <ReactEcharts ref='echartsInstance'\n                  style={{ height: style.height_graph}}\n                  option={this.getOption('pres')} />\n              </Col>\n              <Col>\n                <ReactEcharts ref='echartsInstance'\n                  style={{ height: style.height_graph}}\n                  option={this.getOption('rh')} />\n              </Col>\n            </Row>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n}\n\n}\n\n\nexport default DrawGraphs;\n"]},"metadata":{},"sourceType":"module"}